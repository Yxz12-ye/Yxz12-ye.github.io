import{_ as b}from"./ValaxyMain.vue_vue_type_style_index_0_lang.DYz-Ay_j.js";import"./chunks/@vueuse/motion.CfOaydB9.js";import{e as c,u as C,a as f}from"./chunks/vue-router.BAt3aDh2.js";import{aa as v,ap as n,ag as o,af as t,ae as R,ai as e,W as k,a9 as y,F as D,ab as E,Z as A}from"./framework.Dtj2FOgl.js";import"./app.BEkqb5mH.js";import"./chunks/dayjs.BdcnXKr1.js";import"./chunks/vue-i18n.-J8ISBuY.js";import"./chunks/pinia.ecF83nE_.js";/* empty css                    */import"./chunks/nprogress.B6x19dEb.js";import"./YunComment.vue_vue_type_style_index_0_lang.DgZ01wsw.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.BnNbMMRz.js";import"./post.DLBzRB45.js";const B={class:"tip custom-block"},M={class:"custom-block-title custom-block-title-default"},x=c("/posts/2025/Unity游戏CodeRegistration和MetadataRegistration的获取",async l=>JSON.parse('{"title":"CodeRegistration和MetadataRegistration的获取","description":"","frontmatter":{"title":"CodeRegistration和MetadataRegistration的获取","date":"2025-11-16 20:02:00","updated":"2025-11-16 20:02:00","categories":["技术"],"tags":["C#"]},"headers":[],"relativePath":"pages/posts/2025/Unity游戏CodeRegistration和MetadataRegistration的获取.md","lastUpdated":1766588262000}'),{lazy:(l,i)=>l.name===i.name}),j={__name:"Unity游戏CodeRegistration和MetadataRegistration的获取",setup(l,{expose:i}){const{data:d}=x(),p=f(),u=C(),r=Object.assign(u.meta.frontmatter||{},d.value?.frontmatter||{});return p.currentRoute.value.data=d.value,A("valaxy:frontmatter",r),globalThis.$frontmatter=r,i({frontmatter:{title:"CodeRegistration和MetadataRegistration的获取",date:"2025-11-16 20:02:00",updated:"2025-11-16 20:02:00",categories:["技术"],tags:["C#"]}}),(s,a)=>{const m=y("VT"),g=b;return E(),v(g,{frontmatter:D(r)},{"main-content-md":n(()=>[a[1]||(a[1]=t("h2",{id:"unity游戏coderegistration和metadataregistration的获取",tabindex:"-1"},[e("Unity游戏CodeRegistration和MetadataRegistration的获取 "),t("a",{class:"header-anchor",href:"#unity游戏coderegistration和metadataregistration的获取","aria-label":'Permalink to "Unity游戏CodeRegistration和MetadataRegistration的获取"'},"​")],-1)),t("div",B,[t("p",M,[k(m,{content:"blocks.tip"})]),a[0]||(a[0]=t("p",null,"前因是我在玩蓝途王子, 打翻译Mod时需要反编译Il2Cpp, 而BepInex还不支持v31的元数据, 遂用Il2CppDumper, 结果一开始选错文件导致一直反编译失败, 所以一些内容我就删了, 以免造成误导.",-1))]),a[2]||(a[2]=t("p",null,"那么直接开始吧",-1)),a[3]||(a[3]=t("p",null,"首先用IDA Pro打开游戏的GameAssembly.dll",-1)),a[4]||(a[4]=t("p",null,[e("在字符串视图搜索"),t("code",null,"global-metadata.dat"),e(", (如果没搜到就是加密了, 目前还不会解密)")],-1)),a[5]||(a[5]=t("p",null,"可以得到:",-1)),a[6]||(a[6]=t("div",{class:"language-"},[t("button",{title:"Copy code",class:"copy"}),t("span",{class:"lang"}),t("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[t("code",{"v-pre":""},[t("span",{class:"line"},[t("span",null,".rdata:0000000182CC0660 67 6C 6F 62 61 6C 2D 6D 65 74     aGlobalMetadata db 'global-metadata.dat',0")])])]),t("button",{class:"code-block-unfold-btn"})],-1)),R(" more "),a[7]||(a[7]=t("p",null,"接着右键查找交叉引用(xrefs to)",-1)),a[8]||(a[8]=t("p",null,"我们可以看到一个清晰的引用图(本人IDA 9.2版本, 交叉引用有清晰的引用图)",-1)),a[9]||(a[9]=t("p",null,"可以知道(A->B, 表示A调用了B)",-1)),a[10]||(a[10]=t("div",{class:"language-"},[t("button",{title:"Copy code",class:"copy"}),t("span",{class:"lang"}),t("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[t("code",{"v-pre":""},[t("span",{class:"line"},[t("span",null,"sub_180291260->sub_1802A5CC0->sub_180290BE0->aGlobalMetadata")])])]),t("button",{class:"code-block-unfold-btn"})],-1)),a[11]||(a[11]=t("p",null,[e("(以下内容参考大佬的博客"),t("a",{href:"https://tomorrowisnew.com/posts/Finding-CodeRegistration-and-MetadataRegistration/",target:"_blank",rel:"noreferrer"},"Il2cppDumper Manually Finding CodeRegistration and MetadataRegistration | Tomorrowisnew"),e(")")],-1)),a[12]||(a[12]=t("p",null,"可知il2cpp调用metadata方式如下",-1)),a[13]||(a[13]=t("div",{class:"language-"},[t("button",{title:"Copy code",class:"copy"}),t("span",{class:"lang"}),t("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[t("code",{"v-pre":""},[t("span",{class:"line"},[t("span",null,"il2cpp::vm::Runtime::Init->il2cpp::vm::MetadataCache::Initialize->global-metadata.dat")])])]),t("button",{class:"code-block-unfold-btn"})],-1)),a[14]||(a[14]=t("p",null,[e("那么就在调用"),t("code",null,"il2cpp::vm::Runtime::Init"),e("的上方就能找到"),t("code",null,"CodeRegistration"),e("和"),t("code",null,"MetadataRegistration")],-1)),a[15]||(a[15]=t("p",null,[e("返回IDA Pro, 我们得知"),t("code",null,"sub_180291260"),e("函数会调用"),t("code",null,"sub_1802A5CC0"),e(",而这里"),t("code",null,"sub_1802A5CC0"),e("就是"),t("code",null,"il2cpp::vm::Runtime::Init"),e(", 因此调用"),t("code",null,"sub_1802A5CC0"),e("的位置上面就是我们需要的东西")],-1)),a[16]||(a[16]=t("p",null,[e("进入"),t("code",null,"sub_180291260"),e(", 搜索text : "),t("code",null,"sub_1802A5CC0")],-1)),a[17]||(a[17]=t("div",{class:"language-"},[t("button",{title:"Copy code",class:"copy"}),t("span",{class:"lang"}),t("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[t("code",{"v-pre":""},[t("span",{class:"line"},[t("span",null,".text:00000001802914D0 258 48 8D 0D 49 87 51 02          lea     rcx, unk_1827A9C20")]),e(`
`),t("span",{class:"line"},[t("span",null,".text:00000001802914D7 258 48 89 0D 9A B1 EE 02          mov     cs:qword_18317C678, rcx")]),e(`
`),t("span",{class:"line"},[t("span",null,".text:00000001802914DE 258 48 8D 05 FB E8 87 02          lea     rax, unk_182B0FDE0")]),e(`
`),t("span",{class:"line"},[t("span",null,".text:00000001802914E5 258 48 89 05 A4 B1 EE 02          mov     cs:qword_18317C690, rax")]),e(`
`),t("span",{class:"line"},[t("span",null,".text:00000001802914EC 258 48 89 0D 85 B0 EE 02          mov     cs:qword_18317C578, rcx")]),e(`
`),t("span",{class:"line"},[t("span",null,".text:00000001802914F3 258 48 89 05 8E B0 EE 02          mov     cs:qword_18317C588, rax")]),e(`
`),t("span",{class:"line"},[t("span",null,".text:00000001802914FA 258 48 8D 05 07 87 51 02          lea     rax, unk_1827A9C08")]),e(`
`),t("span",{class:"line"},[t("span",null,".text:0000000180291501 258 48 89 05 68 B0 EE 02          mov     cs:qword_18317C570, rax")]),e(`
`),t("span",{class:"line"},[t("span",null,".text:0000000180291508 258 E8 B3 47 01 00                call    sub_1802A5CC0")])])]),t("button",{class:"code-block-unfold-btn"})],-1)),a[18]||(a[18]=t("p",null,[e("可以看到"),t("code",null,"lea rcx, unk_1827A9C20"),e("和"),t("code",null,"lea rax, unk_182B0FDE0")],-1)),a[19]||(a[19]=t("p",null,[e("而"),t("code",null,"1827A9C20"),e("和"),t("code",null,"182B0FDE0"),e("分别就是"),t("code",null,"CodeRegistration"),e("和"),t("code",null,"MetadataRegistration")],-1))]),"main-header":n(()=>[o(s.$slots,"main-header")]),"main-header-after":n(()=>[o(s.$slots,"main-header-after")]),"main-nav":n(()=>[o(s.$slots,"main-nav")]),"main-content-before":n(()=>[o(s.$slots,"main-content-before")]),"main-content":n(()=>[o(s.$slots,"main-content")]),"main-content-after":n(()=>[o(s.$slots,"main-content-after")]),"main-nav-before":n(()=>[o(s.$slots,"main-nav-before")]),"main-nav-after":n(()=>[o(s.$slots,"main-nav-after")]),comment:n(()=>[o(s.$slots,"comment")]),footer:n(()=>[o(s.$slots,"footer")]),aside:n(()=>[o(s.$slots,"aside")]),"aside-custom":n(()=>[o(s.$slots,"aside-custom")]),default:n(()=>[o(s.$slots,"default")]),_:3},8,["frontmatter"])}}};export{j as default,x as usePageData};
