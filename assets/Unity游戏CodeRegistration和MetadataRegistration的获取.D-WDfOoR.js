import{_ as g}from"./ValaxyMain.vue_vue_type_style_index_0_lang.rb-rlXd9.js";import"./chunks/@vueuse/motion.CfOaydB9.js";import{e as c,u as C,a as b}from"./chunks/vue-router.DlByA8cB.js";import{aa as f,ap as s,ag as e,af as a,ae as R,ai as t,F as v,ab as y,Z as k}from"./framework.Dtj2FOgl.js";import"./app.ynKPqpEp.js";import"./chunks/dayjs.BdcnXKr1.js";import"./chunks/vue-i18n.-J8ISBuY.js";import"./chunks/pinia.ecF83nE_.js";/* empty css                    */import"./chunks/nprogress.B6x19dEb.js";import"./YunComment.vue_vue_type_style_index_0_lang.BGovOux3.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.BnNbMMRz.js";import"./post.BtrpLqDq.js";const I=c("/posts/Unity游戏CodeRegistration和MetadataRegistration的获取",async o=>JSON.parse('{"title":"CodeRegistration和MetadataRegistration的获取","description":"","frontmatter":{"title":"CodeRegistration和MetadataRegistration的获取","data":"2025-11-16 20:02:00","updated":"2025-11-16 20:02:00","categories":["技术"],"tags":["C#"]},"headers":[],"relativePath":"pages/posts/Unity游戏CodeRegistration和MetadataRegistration的获取.md","lastUpdated":null}'),{lazy:(o,i)=>o.name===i.name}),q={__name:"Unity游戏CodeRegistration和MetadataRegistration的获取",setup(o,{expose:i}){const{data:p}=I(),u=b(),d=C(),r=Object.assign(d.meta.frontmatter||{},p.value?.frontmatter||{});return u.currentRoute.value.data=p.value,k("valaxy:frontmatter",r),globalThis.$frontmatter=r,i({frontmatter:{title:"CodeRegistration和MetadataRegistration的获取",data:"2025-11-16 20:02:00",updated:"2025-11-16 20:02:00",categories:["技术"],tags:["C#"]}}),(l,n)=>{const m=g;return y(),f(m,{frontmatter:v(r)},{"main-content-md":s(()=>[n[0]||(n[0]=a("h2",{id:"unity游戏coderegistration和metadataregistration的获取",tabindex:"-1"},[t("Unity游戏CodeRegistration和MetadataRegistration的获取 "),a("a",{class:"header-anchor",href:"#unity游戏coderegistration和metadataregistration的获取","aria-label":'Permalink to "Unity游戏CodeRegistration和MetadataRegistration的获取"'},"​")],-1)),n[1]||(n[1]=a("p",null,"(我也不知道我为什么要搞这么硬核)",-1)),n[2]||(n[2]=a("p",null,"首先用IDA Pro打开游戏的GameAssembly.dll",-1)),n[3]||(n[3]=a("p",null,[t("在字符串视图搜索"),a("code",null,"global-metadata.dat"),t(", (如果没搜到就是加密了, 目前还不会解密)")],-1)),n[4]||(n[4]=a("p",null,"可以得到:",-1)),n[5]||(n[5]=a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,".rdata:0000000182CC0660 67 6C 6F 62 61 6C 2D 6D 65 74     aGlobalMetadata db 'global-metadata.dat',0")])])]),a("button",{class:"code-block-unfold-btn"})],-1)),R(" more "),n[6]||(n[6]=a("p",null,"接着右键查找交叉引用(xrefs to)",-1)),n[7]||(n[7]=a("p",null,"我们可以看到一个清晰的引用图(本人IDA 9.2版本, 交叉引用有清晰的引用图)",-1)),n[8]||(n[8]=a("p",null,"可以知道",-1)),n[9]||(n[9]=a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"sub_180291260->sub_1802A5CC0->sub_180290BE0->aGlobalMetadata")])])]),a("button",{class:"code-block-unfold-btn"})],-1)),n[10]||(n[10]=a("p",null,[t("(以下内容参考大佬的博客"),a("a",{href:"https://tomorrowisnew.com/posts/Finding-CodeRegistration-and-MetadataRegistration/",target:"_blank",rel:"noreferrer"},"Il2cppDumper Manually Finding CodeRegistration and MetadataRegistration | Tomorrowisnew"),t(")")],-1)),n[11]||(n[11]=a("p",null,"可知il2cpp调用metadata方式如下",-1)),n[12]||(n[12]=a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"il2cpp::vm::Runtime::Init->il2cpp::vm::MetadataCache::Initialize->global-metadata.dat")])])]),a("button",{class:"code-block-unfold-btn"})],-1)),n[13]||(n[13]=a("p",null,[t("那么就在调用"),a("code",null,"il2cpp::vm::Runtime::Init"),t("的上方就能找到"),a("code",null,"CodeRegistration"),t("和"),a("code",null,"MetadataRegistration")],-1)),n[14]||(n[14]=a("p",null,[t("返回IDA Pro, 我们得知"),a("code",null,"sub_180291260"),t("函数会调用"),a("code",null,"sub_1802A5CC0"),t(",而这里CC0就是"),a("code",null,"il2cpp::vm::Runtime::Init"),t(", 因此调用"),a("code",null,"sub_1802A5CC0"),t("的位置上面就是我们需要的东西")],-1)),n[15]||(n[15]=a("p",null,[t("进入"),a("code",null,"sub_180291260"),t(", 搜索text : "),a("code",null,"sub_1802A5CC0")],-1)),n[16]||(n[16]=a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,".text:00000001802914D0 258 48 8D 0D 49 87 51 02          lea     rcx, unk_1827A9C20")]),t(`
`),a("span",{class:"line"},[a("span",null,".text:00000001802914D7 258 48 89 0D 9A B1 EE 02          mov     cs:qword_18317C678, rcx")]),t(`
`),a("span",{class:"line"},[a("span",null,".text:00000001802914DE 258 48 8D 05 FB E8 87 02          lea     rax, unk_182B0FDE0")]),t(`
`),a("span",{class:"line"},[a("span",null,".text:00000001802914E5 258 48 89 05 A4 B1 EE 02          mov     cs:qword_18317C690, rax")]),t(`
`),a("span",{class:"line"},[a("span",null,".text:00000001802914EC 258 48 89 0D 85 B0 EE 02          mov     cs:qword_18317C578, rcx")]),t(`
`),a("span",{class:"line"},[a("span",null,".text:00000001802914F3 258 48 89 05 8E B0 EE 02          mov     cs:qword_18317C588, rax")]),t(`
`),a("span",{class:"line"},[a("span",null,".text:00000001802914FA 258 48 8D 05 07 87 51 02          lea     rax, unk_1827A9C08")]),t(`
`),a("span",{class:"line"},[a("span",null,".text:0000000180291501 258 48 89 05 68 B0 EE 02          mov     cs:qword_18317C570, rax")]),t(`
`),a("span",{class:"line"},[a("span",null,".text:0000000180291508 258 E8 B3 47 01 00                call    sub_1802A5CC0")])])]),a("button",{class:"code-block-unfold-btn"})],-1)),n[17]||(n[17]=a("p",null,[t("可以看到"),a("code",null,"lea rcx, unk_1827A9C20"),t("和"),a("code",null,"lea rax, unk_182B0FDE0")],-1)),n[18]||(n[18]=a("p",null,[t("而"),a("code",null,"1827A9C20"),t("和"),a("code",null,"182B0FDE0"),t("分别就是"),a("code",null,"CodeRegistration"),t("和"),a("code",null,"MetadataRegistration")],-1)),n[19]||(n[19]=a("p",null,"不过用il2cppdumper时发现报错:",-1)),n[20]||(n[20]=a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"Initializing metadata...")]),t(`
`),a("span",{class:"line"},[a("span",null,"Metadata Version: 31")]),t(`
`),a("span",{class:"line"},[a("span",null,"Initializing il2cpp file...")]),t(`
`),a("span",{class:"line"},[a("span",null,"Il2Cpp Version: 31")]),t(`
`),a("span",{class:"line"},[a("span",null,"Searching...")]),t(`
`),a("span",{class:"line"},[a("span",null,"CodeRegistration : 0")]),t(`
`),a("span",{class:"line"},[a("span",null,"MetadataRegistration : 0")]),t(`
`),a("span",{class:"line"},[a("span",null,"Use custom PE loader")]),t(`
`),a("span",{class:"line"},[a("span",null,"CodeRegistration : 0")]),t(`
`),a("span",{class:"line"},[a("span",null,"MetadataRegistration : 0")]),t(`
`),a("span",{class:"line"},[a("span",null,"ERROR: Can't use auto mode to process file, try manual mode.")]),t(`
`),a("span",{class:"line"},[a("span",null,"Input CodeRegistration: 0x1827A9C10")]),t(`
`),a("span",{class:"line"},[a("span",null,"Input MetadataRegistration: 0x182B0FDE0")]),t(`
`),a("span",{class:"line"},[a("span",null,"System.OverflowException: Arithmetic operation resulted in an overflow.")]),t(`
`),a("span",{class:"line"},[a("span",null,"   at Il2CppDumper.BinaryStream.ReadClassArray[T](Int64 count) in C:\\projects\\il2cppdumper\\Il2CppDumper\\IO\\BinaryStream.cs:line 187")]),t(`
`),a("span",{class:"line"},[a("span",null,"   at Il2CppDumper.Il2Cpp.Init(UInt64 codeRegistration, UInt64 metadataRegistration) in C:\\projects\\il2cppdumper\\Il2CppDumper\\Il2Cpp\\Il2Cpp.cs:line 174")]),t(`
`),a("span",{class:"line"},[a("span",null,"   at Il2CppDumper.Program.Init(String il2cppPath, String metadataPath, Metadata& metadata, Il2Cpp& il2Cpp) in C:\\projects\\il2cppdumper\\Il2CppDumper\\Program.cs:line 236")]),t(`
`),a("span",{class:"line"},[a("span",null,"ERROR: An error occurred while processing.")]),t(`
`),a("span",{class:"line"},[a("span",null,"Press any key to exit...")])])]),a("button",{class:"code-block-unfold-btn"})],-1)),n[21]||(n[21]=a("p",null,"感觉像是Bug",-1)),n[22]||(n[22]=a("p",null,[t("但是使用"),a("code",null,"MelonLoader"),t("的dump却得出了")],-1)),n[23]||(n[23]=a("div",{class:"language-"},[a("button",{title:"Copy code",class:"copy"}),a("span",{class:"lang"}),a("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[a("code",{"v-pre":""},[a("span",{class:"line"},[a("span",null,"[21:25:09.993] [Il2CppAssemblyGenerator] [Info] [Library] Got Binary codereg: 0x1827A9C10, metareg: 0x182B0FDE0 in 216ms.")])])]),a("button",{class:"code-block-unfold-btn"})],-1)),n[24]||(n[24]=a("p",null,"emm…, 第一个竟然相差了10 ??",-1)),n[25]||(n[25]=a("p",null,"由于这里本人也不是很懂, 所以无法深入研究",-1))]),"main-header":s(()=>[e(l.$slots,"main-header")]),"main-header-after":s(()=>[e(l.$slots,"main-header-after")]),"main-nav":s(()=>[e(l.$slots,"main-nav")]),"main-content-before":s(()=>[e(l.$slots,"main-content-before")]),"main-content":s(()=>[e(l.$slots,"main-content")]),"main-content-after":s(()=>[e(l.$slots,"main-content-after")]),"main-nav-before":s(()=>[e(l.$slots,"main-nav-before")]),"main-nav-after":s(()=>[e(l.$slots,"main-nav-after")]),comment:s(()=>[e(l.$slots,"comment")]),footer:s(()=>[e(l.$slots,"footer")]),aside:s(()=>[e(l.$slots,"aside")]),"aside-custom":s(()=>[e(l.$slots,"aside-custom")]),default:s(()=>[e(l.$slots,"default")]),_:3},8,["frontmatter"])}}};export{q as default,I as usePageData};
